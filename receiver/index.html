<!DOCTYPE HTML>

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />

		<script src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>
		<link rel="stylesheet" href="css/app.css" />
	</head>
	<body>
		<div id="player">Hello</div>
		<script>
		var APP_NS = "urn:x-cast:io.dusq";

		var appConfig, appController, customMessageBus;

		window.castReceiverManager = cast.receiver.CastReceiverManager.getInstance();

		appConfig = new cast.receiver.CastReceiverManager.Config();

		appConfig.statusText = "Readt to play";
		appConfig.maxInactivity = 30000;

		customMessageBus = castReceiverManager.getCastMessageBus(APP_NS);

		appController = {
			_commands: {},

			registerCommand: function(name, command) {
				this._commands[name] = command;
			},

			command: function() {
				return this._commands[name] || function() {};
			},

			onMessage: function(event) {
				var data = JSON.parse(event.data);

				appController.command(data.command)
					.apply(appController, data.args);
			}
		};

		customMessageBus.onMessage = appController.onMessage;
    	window.castReceiverManager.start(appConfig);

    	appController.registerCommand('setColor', function( color ) {
			document.body.style.backgroundColor = color;
		});
		</script>
	</body>
</html>
